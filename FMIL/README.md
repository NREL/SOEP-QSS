# FMI Library (FMIL) in SOEP-QSS

FMIL 2.4.1 is integrated into the SOEP-QSS respository and is automatically built when QSS is built.
* QSS uses a slightly modified version of FMIL.
* Building FMIL requires CMake and GNU Make.

## Building FMIL

* The console must be configured with the corresponding `setQSS` script before building FMIL.
* The QSS build will automatically run the appropriate FMIL build by running `FMIL/bin/bld`.
* The `FMIL/bin/bld` script can also be run directly to build the FMIL that the console is configured for.
* The `FMIL/bin/cln` script can be run to clean up files generated by the FMIL build. (The QSS `cln` script calls this automatically.)
* Some compilers can't currently build FMIL but use a binary compatible FMIL built with another compiler.
* CMake and GNU Make are required to build FMIL for SOEP-QSS.

## Directories
* `bin`  FMIL build scripts for supported platforms and compilers. Also contains CMake and FMIL installation directories for FMIL builds.
* `src`  FMIL (slightly modified) source code.

## Notes

### FMIL
* FMIL and its dependencies are written in C and generate many compiler warnings. Many of these are suppressed by the FMIL builds.

### Windows
* MinGW make 4.4.1 has a bug preventing the -O / --output-sync option from working in FMIL builds so parallel compilation output is jumbled.
* The debug zlib library is named zlibd.lib with Windows Visual C++ and Intel C++ builds. We rename it to zlib.lib to keep the build setup simpler.

### Intel C++
* Intel C++ scripts are in the `IX` directories under `FMIL/bin`.
* On Windows Intel oneAPI C++ currently gives the best SOEP-QSS performance and has the most current OpenMP support so it is recommended for SOEP-QSS Windows builds.
* The LLVM-based Intel C++ compiler (icx) does not currently succeed in building FMIL so the GCC (on Linux) or Visual C++ (on Windows) FMIL builds are used.
* The Intel "Classic" C++ compiler has been removed from oneAPI and is no longer supported for SOEP-QSS.
* The debug zlib library is named zlibd.lib with Windows Intel C++ builds: we rename it to zlib.lib to keep the build setup simpler.

### Visual C++
* Visual C++ scripts are in the `VC` directories under `FMIL/bin`.
* Visual C++ 2017 and 2019 and 2022 are supported for SOEP-QSS.

### GCC
* GCC scripts are in the `GCC` directories under `FMIL/bin`.
* Windows: Recent GCC releases such as from [WinLibs](https://winlibs.com) or [equation.com](http://www.equation.com/servlet/equation.cmd?fa=fortran) should work.
* Linux: Recent GCC releases should work.

### Clang
* Clang scripts are in the `Clang` directories under `FMIL/bin`.
* Windows LLVM and MinGW Clang compilers are currently unable to build FMIL due to lack of support by zlib. (This is probably also true for the Visual C++ clang-cl compiler but that hasn't been tried yet.)

## Resources
* https://github.com/modelon-community/fmi-library.git

